const m="https://utcvm.use1.ezyvet.com",u=["Urinalysis","Urinalalysis"],y=["Lipemic Serum Index","Hemolytic Serum Index","Icteric Serum Index","Additional Results: Additional Results","Additional Results: Attached Report"];function c(e){try{return new URL(e).origin===m}catch{return!1}}chrome.action.disable();chrome.tabs.onUpdated.addListener(async(e,t,n)=>{const s=t.url??(n==null?void 0:n.url);if(!s)return;const a=c(s);try{a?await chrome.sidePanel.setOptions({tabId:e,path:"sidepanel/index.html",enabled:!0}):await chrome.sidePanel.setOptions({tabId:e,enabled:!1})}catch(o){console.warn("Failed to set side panel options:",o)}});chrome.tabs.onActivated.addListener(async e=>{const t=await chrome.tabs.get(e.tabId);c(t.url)?chrome.action.enable(t.id):chrome.action.disable(t.id)});async function d(){try{const e=await chrome.storage.sync.get(["trendsDisablePanels","trendsDisableTests"]),t=Array.isArray(e.trendsDisablePanels)?e.trendsDisablePanels:[],n=Array.isArray(e.trendsDisableTests)?e.trendsDisableTests:[],s=new Set([...t,...u]),a=new Set([...n,...y]),o=Array.from(s),i=Array.from(a);await chrome.storage.sync.set({trendsDisablePanels:o,trendsDisableTests:i})}catch(e){console.warn("Failed to set default trends options:",e)}}chrome.runtime.onInstalled.addListener(async()=>{var t;const e=await chrome.tabs.query({});for(const n of e){const s=c(n.url);s?chrome.action.enable(n.id):chrome.action.disable(n.id);try{await chrome.sidePanel.setOptions({tabId:n.id,path:"sidepanel/index.html",enabled:s})}catch(a){console.warn("Failed to set side panel options:",a)}}try{await((t=chrome.sidePanel)==null?void 0:t.setPanelBehavior({openPanelOnActionClick:!0}))}catch(n){console.warn("Failed to set side panel behavior:",n)}await d()});chrome.runtime.onStartup.addListener(async()=>{var e;try{await((e=chrome.sidePanel)==null?void 0:e.setPanelBehavior({openPanelOnActionClick:!0}))}catch(t){console.warn("Failed to set side panel behavior on startup:",t)}await d()});chrome.action.onClicked.addListener(async e=>{var t;if(!(!(e!=null&&e.id)||!c(e.url)))try{await((t=chrome.sidePanel)==null?void 0:t.open({tabId:e.id}))}catch(n){console.warn("Failed to open side panel:",n)}});chrome.runtime.onMessage.addListener((e,t,n)=>{var s,a,o,i;if(console.log("SW received message:",e),(e==null?void 0:e.type)==="PING"){const h=Date.now();try{(a=(s=chrome.action).setBadgeBackgroundColor)==null||a.call(s,{color:"#16a34a"}),(i=(o=chrome.action).setBadgeText)==null||i.call(o,{text:"PONG"}),setTimeout(()=>{var r,l;try{(l=(r=chrome.action).setBadgeText)==null||l.call(r,{text:""})}catch{}},1500)}catch(r){console.warn("Failed to set badge text for PING:",r)}n({type:"PONG",time:h})}});
